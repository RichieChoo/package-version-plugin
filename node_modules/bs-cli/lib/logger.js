const chalk = require('chalk');
const log = require('./fancy-log');
const config = require('./constant');
const path = require('path');
const fs = require('fs');
const { clearSpace } = require('./utils');

const logger = {
  success: (text, logPath, success,noTime) => {
    if (success) {
      if (logPath) {
        const tip = 'A complete log of this run can be found in:';
        log(chalk['blue'](tip), false, tip,noTime);
        log(chalk['blue'](logPath), false, logPath,noTime);
      }
      log(chalk['green'](text), logPath, text,noTime);
    } else {
      log(chalk['blue'](text), logPath, text,noTime);
    }
  },

  err: (err, logPath, notTop, exitCode,noTime) => {
    !notTop && log('');
    log(chalk['red'](err), logPath, err,noTime);
    //clear 工作空间
    if (logPath) {
      const workspace = path.dirname(logPath);
      if (fs.existsSync(workspace)) {
        clearSpace(workspace, () => {
          process.exit(exitCode ? exitCode : 1);
        });
      } else {
        const workspacetip = `Not exists workspace folder: ${workspace} `;
        log(chalk['red'](`workspacetip`), logPath, workspacetip,noTime);
        process.exit(exitCode ? exitCode : 1);
      }
    } else {
      process.exit(exitCode ? exitCode : 1);
    }
  },
};

exports = module.exports = logger;
