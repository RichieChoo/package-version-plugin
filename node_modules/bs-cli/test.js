const fs = require("fs");
const join = require("path").join;
const exec = require("child_process").exec;

const skipFolders = ["test", "sdm-ui-common"];
// const skipFolders = ["sdm-ui-integration"];
const basicBash = `cp -rf src /home/richie/work/test/`;
// const basicBash = `bs patch && npm publish`;

const currentPath = process.cwd();
console.log("batch update path:", currentPath);
let files = fs.readdirSync(currentPath);
files.forEach(item => {
	let fPath = join(currentPath, item);
	const fPathArr = fPath.split("/");
	const filterFlag = skipFolders.includes(item) || /^\./.test(item);
	let stat = fs.statSync(fPath);
	let bash = ` cd ${fPath} && ${basicBash}${item}`;

	//filter folders
	if (stat.isDirectory() === true) {
		if (filterFlag) {
			console.log("skip folder:" + fPath);
		} else {
			exec(bash, (error, stdout, stderr) => {
				console.log("exec cmd:", bash);
				if (error) {
					console.log(error);
					process.exit();
				} else {
					console.log(stdout);
				}
			});
		}
	}
	if (stat.isFile() === true) {
		console.log(fPath + " is a file ,skipped it!");
	}
});
